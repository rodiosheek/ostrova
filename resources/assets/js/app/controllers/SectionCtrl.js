function SectionCtrl($scope, $rootScope, $location, $routeParams, $route, $http, mapService) {
    console.log('Section controller');

    
    $scope.section = $routeParams.section;
    $scope.id = $routeParams.id;
    var building = $routeParams.id;
    var section = $routeParams.section;
    console.log($scope.section + ' / ' + $scope.id);

    $scope.paths = jsonCoords[building][section];
    console.log($scope.paths);
    

    $scope.sectionInit = function () {
        $rootScope.loading = true;
        setTimeout(function () {
            $('.map-plans').svgDrawing({
                onclick: function (el) {
                    var floor = el.data('alt');
                    if(!$('.popup-menu').find('a[data-target=' + floor + ']').hasClass('non-active')) {
                        $scope.$apply(function () {
                            $location.path('/building/' + $scope.id + '/section/' + $scope.section + '/floor/' + floor);
                        })
                    }
                },
                onmouseover: function (el) {

                    var floor = el.data('alt');
                    
                    var getFloorFlatsCount = mapService.getFloorFlats($scope.section, floor);
                    getFloorFlatsCount.then(
                        function(data) {
                            $scope.flats = data;
                        },
                        function(error) {
                            console.log(error);
                        }
                    );
                    el.attr('opacity', 0.5);

                    $('.popup-menu').find('div[data-target=' + floor + ']').find('.corps-link-popup').show();
                },
                onmouseout: function (el) {
                    el.attr('opacity', 0);
                    var alt = el.data('alt');
                    $('.popup-menu').find('div[data-target=' + alt + ']').find('.corps-link-popup').hide();
                }
            });
            $rootScope.loading = false;
        }, 1000);
    };
};

app.controller('SectionCtrl', SectionCtrl);

var jsonCoords = {
    "9a" : {
        "1" : [
                "552,882,995,881,995,842,553,843",
                "995,842,995,808,553,809,552,843",
                "552,809,551,774,994,775,995,808",
                "994,775,994,740,551,741,551,774",
                "551,741,551,707,995,707,995,740",
                "995,707,995,671,552,671,552,707",
                "995,671,995,639,551,638,551,671",
                "995,639,995,605,552,605,551,638",
                "552,605,552,573,995,574,995,605",
                "995,574,995,541,552,539,552,573",
                "995,541,995,507,551,506,552,539",
                "995,507,995,474,552,474,551,506",
                "995,474,995,440,552,439,552,474",
                "995,440,994,406,552,405,552,439",
                "995,406,995,373,552,372,552,405",
                "995,373,994,338,551,338,552,372",
                "995,338,995,304,551,302,551,338",
                "995,304,994,272,552,271,551,302",
                "994,272,995,239,551,239,552,271"
        ],
        "2" : [
                "994,884,1437,883,1437,844,995,845",
                "1437,844,1437,810,995,811,994,845",
                "995,811,994,776,1437,777,1438,810",
                "1437,777,1437,742,994,743,994,776",
                "994,743,994,709,1438,709,1438,742",
                "1438,709,1438,673,995,673,995,709",
                "1439,673,1439,641,995,640,995,673",
                "1439,641,1439,607,996,607,995,640",
                "996,607,996,575,1439,576,1439,607",
                "1440,576,1440,543,997,541,997,575",
                "1440,543,1440,509,996,508,997,541",
                "1440,509,1440,476,997,476,996,508",
                "1440,476,1440,442,997,441,997,476",
                "1441,442,1440,408,998,407,998,441",
                "1441,408,1441,375,998,374,998,407",
                "1441,375,1440,340,997,340,998,374",
                "1441,340,1441,306,997,304,997,340",
                "1441,306,1440,274,998,273,997,304",
                "1439,274,1440,241,996,241,997,273"
            ]
    },
    "29a" : {
        "1" : [
                "261,824,965,829,966,768,262,766",
                "262,766,966,768,966,707,263,707",
                "966,707,262,706,262,658,966,659",
                "262,659,262,606,966,603,966,659",
                "967,603,262,606,263,553,967,553",
                "263,553,264,501,967,501,968,553",
                "966,501,967,448,262,448,263,501",
                "263,448,262,393,966,393,967,448",
                "967,393,966,339,262,340,263,392",
                "966,340,965,287,263,288,263,339"
        ],
        "2" : [
                "1671,823,966,823,967,769,1671,771",
                "967,769,968,717,1671,714,1671,771",
                "968,718,970,663,1671,660,1672,714",
                "1672,660,1672,609,970,609,970,663",
                "1672,609,1672,553,967,556,968,609",
                "967,556,967,502,1671,502,1673,553",
                "1671,502,1671,447,967,447,967,502",
                "968,447,968,393,1671,392,1670,446",
                "1671,393,1670,339,967,339,968,393",
                "1671,339,1671,287,967,286,967,338"
            ]
    },
    "30" : {
        "1" : [
                "261,824,965,829,966,768,262,766",
                "262,766,966,768,966,707,263,707",
                "966,707,262,706,262,658,966,659",
                "262,659,262,606,966,603,966,659",
                "967,603,262,606,263,553,967,553",
                "263,553,264,501,967,501,968,553",
                "966,501,967,448,262,448,263,501",
                "263,448,262,393,966,393,967,448",
                "967,393,966,339,262,340,263,392",
                "966,340,965,287,263,288,263,339"
        ],
        "2" : [
                "1671,823,966,823,967,769,1671,771",
                "967,769,968,717,1671,714,1671,771",
                "968,718,970,663,1671,660,1672,714",
                "1672,660,1672,609,970,609,970,663",
                "1672,609,1672,553,967,556,968,609",
                "967,556,967,502,1671,502,1673,553",
                "1671,502,1671,447,967,447,967,502",
                "968,447,968,393,1671,392,1670,446",
                "1671,393,1670,339,967,339,968,393",
                "1671,339,1671,287,967,286,967,338"
            ]
    }

};